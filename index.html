<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GlowGuide AI - Professional Skin Analysis</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            text-align: center;
        }
        .header {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }
        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #ff6b6b, #ffa8a8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .camera-box {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }
        #video-container {
            position: relative;
            display: inline-block;
            margin: 10px 0;
        }
        #webcam-video {
            border: 3px solid white;
            border-radius: 10px;
            background: black;
            width: 400px;
            height: 300px;
            object-fit: cover;
            transform: scaleX(-1);
        }
        .camera-placeholder {
            width: 400px;
            height: 300px;
            border: 3px solid white;
            border-radius: 10px;
            background: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
        }
        .buttons {
            margin: 20px 0;
        }
        button {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 15px 30px;
            margin: 10px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }
        button:hover {
            background: #ff5252;
            transform: scale(1.05);
        }
        button:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
        }
        .secondary-btn {
            background: #4CAF50;
        }
        .secondary-btn:hover {
            background: #45a049;
        }
        .stop-btn {
            background: #ff4757;
        }
        .stop-btn:hover {
            background: #ff3742;
        }
        .result-box {
            background: rgba(255, 255, 255, 0.1);
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: left;
        }
        .product {
            background: white;
            color: #333;
            margin: 15px 0;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #ff6b6b;
        }
        .skin-type {
            display: inline-block;
            padding: 10px 25px;
            background: #ff6b6b;
            border-radius: 25px;
            margin: 10px 0;
            font-weight: bold;
            font-size: 1.2em;
        }
        .confidence-display {
            background: rgba(255,255,255,0.2);
            padding: 12px;
            border-radius: 10px;
            margin: 10px 0;
        }
        .disclaimer {
            font-size: 12px;
            opacity: 0.8;
            margin-top: 30px;
        }
        .loading {
            font-size: 18px;
            margin: 20px 0;
            min-height: 30px;
        }
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .feature {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
        }
        .user-count {
            background: rgba(255, 255, 255, 0.2);
            padding: 10px;
            border-radius: 10px;
            margin: 10px 0;
        }
        .prediction-display {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            min-height: 60px;
        }
        .hidden {
            display: none;
        }
        .success-message {
            background: rgba(76, 175, 80, 0.3);
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
        }
        .routine-step {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            border-left: 4px solid #4CAF50;
        }
        .step-number {
            background: #4CAF50;
            color: white;
            padding: 5px 12px;
            border-radius: 50%;
            margin-right: 10px;
            font-weight: bold;
        }
        .ingredient-highlight {
            background: rgba(255,107,107,0.3);
            padding: 2px 8px;
            border-radius: 5px;
            font-weight: bold;
        }
        .product-category {
            background: rgba(255,255,255,0.2);
            padding: 15px;
            margin: 15px 0;
            border-radius: 10px;
        }
        .urgency-badge {
            display: inline-block;
            padding: 5px 12px;
            background: #ff4757;
            border-radius: 15px;
            font-size: 0.8em;
            margin-left: 10px;
        }
        .priority-high {
            background: #ff4757;
        }
        .priority-medium {
            background: #ffa502;
        }
        .priority-low {
            background: #2ed573;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚ú® GlowGuide AI ‚ú®</h1>
            <p>Professional Skin Analysis & Personalized Routine</p>
            <div class="user-count">
                <strong>üöÄ Powered by Real AI - Advanced Recommendations</strong>
            </div>
        </div>

        <div class="success-message">
            <h3>‚úÖ AI Model Connected!</h3>
            <p>Your personal skin analysis AI is ready to provide professional-grade recommendations.</p>
        </div>

        <div class="feature-grid">
            <div class="feature">
                <h3>üß† Smart AI</h3>
                <p>Advanced skin analysis</p>
            </div>
            <div class="feature">
                <h3>üíé Custom Routine</h3>
                <p>Step-by-step application</p>
            </div>
            <div class="feature">
                <h3>üéØ Targeted Solutions</h3>
                <p>Ingredient-specific</p>
            </div>
            <div class="feature">
                <h3>üìä Professional Grade</h3>
                <p>Dermatologist-inspired</p>
            </div>
        </div>

        <div class="camera-box">
            <h3>üì∑ AI Skin Analysis</h3>
            
            <div id="video-container">
                <div id="camera-placeholder" class="camera-placeholder">
                    <p>Camera will appear here</p>
                </div>
                <video id="webcam-video" class="hidden" autoplay playsinline></video>
            </div>
            
            <div class="prediction-display" id="prediction-display">
                <p>Click "Start Camera" to begin professional analysis</p>
            </div>
            
            <div class="buttons">
                <button onclick="startCamera()" id="startBtn">üé• Start Camera</button>
                <button onclick="stopCamera()" id="stopBtn" class="stop-btn hidden">‚èπÔ∏è Stop Camera</button>
                <button onclick="analyzeSkin()" id="analyzeBtn" disabled>üîç Analyze Skin</button>
                <button onclick="shareApp()" class="secondary-btn">üì§ Share App</button>
            </div>
        </div>

        <div class="loading" id="loading"></div>

        <div id="result"></div>
        <div id="recommendations"></div>

        <div class="result-box">
            <h3>üí° Tips for Best AI Results</h3>
            <ul style="text-align: left; margin: 15px;">
                <li>Use good lighting facing your face</li>
                <li>Remove makeup for accurate analysis</li>
                <li>Take photo in natural light if possible</li>
                <li>Keep face centered in frame</li>
                <li>Stay still during analysis for best accuracy</li>
            </ul>
        </div>

        <p class="disclaimer">
            ‚ö†Ô∏è Disclaimer: This AI provides cosmetic recommendations only. Not medical advice. 
            Consult a dermatologist for serious concerns. We don't store your images.
        </p>
    </div>

    <!-- TensorFlow.js and Teachable Machine -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>

    <script>
        // Global variables
        let model;
        let webcam;
        let isCameraOn = false;
        let isAnalyzing = false;
        let analysisInterval;

        // ‚úÖ YOUR ACTUAL MODEL URL
        const modelURL = 'https://teachablemachine.withgoogle.com/models/XmgPTvPSp/model.json';
        const metadataURL = 'https://teachablemachine.withgoogle.com/models/XmgPTvPSp/metadata.json';

        // Enhanced skin analysis database with professional recommendations
        const skinConditions = {
            'Acne Skin': {
                description: 'AI detected active breakouts, inflammation, and congestion. Focus on clearing current acne while preventing future breakouts.',
                primaryConcerns: ['Active breakouts', 'Inflammation', 'Excess oil', 'Clogged pores'],
                severityLevel: 'High',
                morningRoutine: [
                    {
                        step: 1,
                        product: 'CeraVe SA Renewing Cleanser',
                        type: 'Cleanser',
                        ingredients: ['Salicylic Acid 0.5%', 'Niacinamide', 'Ceramides'],
                        purpose: 'Deep clean pores and reduce inflammation',
                        application: 'Massage onto damp skin for 60 seconds, then rinse',
                        priority: 'high'
                    },
                    {
                        step: 2,
                        product: 'The Ordinary Niacinamide 10% + Zinc 1%',
                        type: 'Treatment Serum',
                        ingredients: ['Niacinamide 10%', 'Zinc PCA 1%'],
                        purpose: 'Control oil production and reduce redness',
                        application: 'Apply 3-4 drops to entire face, let absorb for 2 minutes',
                        priority: 'high'
                    },
                    {
                        step: 3,
                        product: 'La Roche-Posay Effaclar Duo+',
                        type: 'Treatment Cream',
                        ingredients: ['Salicylic Acid', 'LHA', 'Niacinamide'],
                        purpose: 'Target active breakouts and prevent new ones',
                        application: 'Apply thin layer to affected areas only',
                        priority: 'high'
                    },
                    {
                        step: 4,
                        product: 'Neutrogena Oil-Free Moisture with SPF 35',
                        type: 'Moisturizer + SPF',
                        ingredients: ['SPF 35', 'Glycerin', 'Dimethicone'],
                        purpose: 'Hydrate without clogging pores + sun protection',
                        application: 'Apply evenly to face and neck',
                        priority: 'medium'
                    }
                ],
                eveningRoutine: [
                    {
                        step: 1,
                        product: 'CeraVe Foaming Facial Cleanser',
                        type: 'Cleanser',
                        ingredients: ['Ceramides', 'Hyaluronic Acid', 'Niacinamide'],
                        purpose: 'Remove makeup, oil, and impurities',
                        application: 'Double cleanse if wearing makeup/sunscreen',
                        priority: 'high'
                    },
                    {
                        step: 2,
                        product: 'Paula\'s Choice 2% BHA Liquid Exfoliant',
                        type: 'Exfoliant',
                        ingredients: ['Salicylic Acid 2%', 'Green Tea Extract'],
                        purpose: 'Unclog pores and smooth texture',
                        application: 'Apply with cotton pad 3x weekly, avoid daily use',
                        priority: 'medium'
                    },
                    {
                        step: 3,
                        product: 'The Ordinary Azelaic Acid Suspension 10%',
                        type: 'Treatment',
                        ingredients: ['Azelaic Acid 10%'],
                        purpose: 'Reduce redness and post-acne marks',
                        application: 'Apply pea-sized amount to entire face',
                        priority: 'medium'
                    },
                    {
                        step: 4,
                        product: 'La Roche-Posay Cicaplast Baume B5',
                        type: 'Repair Balm',
                        ingredients: ['Panthenol', 'Madecassoside', 'Shea Butter'],
                        purpose: 'Repair skin barrier and reduce irritation',
                        application: 'Apply as final step on irritated areas',
                        priority: 'low'
                    }
                ],
                weeklyTreatments: [
                    {
                        product: 'The Ordinary AHA 30% + BHA 2% Peeling Solution',
                        frequency: 'Once weekly',
                        purpose: 'Deep exfoliation and pore purification',
                        warning: 'Use for max 10 minutes, avoid on active inflammation'
                    },
                    {
                        product: 'COSRX Acne Pimple Master Patch',
                        frequency: 'As needed',
                        purpose: 'Spot treatment for active pimples',
                        application: 'Apply on clean, dry pimples overnight'
                    }
                ],
                keyIngredients: ['Salicylic Acid', 'Niacinamide', 'Azelaic Acid', 'Zinc'],
                avoidIngredients: ['Heavy oils', 'Comedogenic ingredients', 'Fragrance'],
                expectedResults: 'Visible reduction in breakouts within 2-4 weeks, improved texture in 6-8 weeks'
            },

            'Dry Skin': {
                description: 'AI detected significant dehydration, flakiness, and compromised skin barrier. Focus on intensive hydration and barrier repair.',
                primaryConcerns: ['Dehydration', 'Flakiness', 'Tightness', 'Barrier damage'],
                severityLevel: 'High',
                morningRoutine: [
                    {
                        step: 1,
                        product: 'La Roche-Posay Toleriane Hydrating Gentle Cleanser',
                        type: 'Cleanser',
                        ingredients: ['Ceramides', 'Niacinamide', 'Glycerin'],
                        purpose: 'Gentle cleansing without stripping moisture',
                        application: 'Massage for 30 seconds, rinse with cool water',
                        priority: 'high'
                    },
                    {
                        step: 2,
                        product: 'The Ordinary Hyaluronic Acid 2% + B5',
                        type: 'Hydrating Serum',
                        ingredients: ['Hyaluronic Acid', 'Vitamin B5'],
                        purpose: 'Intense hydration and moisture retention',
                        application: 'Apply to damp skin, press into face',
                        priority: 'high'
                    },
                    {
                        step: 3,
                        product: 'COSRX Advanced Snail 96 Mucin Power Essence',
                        type: 'Essence',
                        ingredients: ['Snail Secretion Filtrate 96%'],
                        purpose: 'Repair and hydrate with snail mucin',
                        application: 'Pat into skin after serum',
                        priority: 'medium'
                    },
                    {
                        step: 4,
                        product: 'Kiehl\'s Ultra Facial Cream',
                        type: 'Moisturizer',
                        ingredients: ['Squalane', 'Glacial Glycoprotein', 'Glycerin'],
                        purpose: '24-hour hydration without heaviness',
                        application: 'Apply generous amount to face and neck',
                        priority: 'high'
                    },
                    {
                        step: 5,
                        product: 'La Roche-Posay Anthelios Melt-in Milk Sunscreen SPF 60',
                        type: 'Sunscreen',
                        ingredients: ['SPF 60', 'Mexoryl XL', 'Glycerin'],
                        purpose: 'High protection with hydrating base',
                        application: 'Apply as final step, reapply every 2 hours',
                        priority: 'high'
                    }
                ],
                eveningRoutine: [
                    {
                        step: 1,
                        product: 'The Ordinary Squalane Cleanser',
                        type: 'Oil Cleanser',
                        ingredients: ['Squalane', 'Ethyl Linoleate'],
                        purpose: 'First cleanse to remove makeup and sunscreen',
                        application: 'Massage dry, then emulsify with water',
                        priority: 'high'
                    },
                    {
                        step: 2,
                        product: 'CeraVe Hydrating Cream-to-Foam Cleanser',
                        type: 'Second Cleanser',
                        ingredients: ['Ceramides', 'Hyaluronic Acid'],
                        purpose: 'Second cleanse without stripping',
                        application: 'Follow oil cleanse, rinse thoroughly',
                        priority: 'high'
                    },
                    {
                        step: 3,
                        product: 'The Ordinary "Buffet" + Copper Peptides 1%',
                        type: 'Treatment Serum',
                        ingredients: ['Copper Peptides', 'Multiple Peptides', 'Hyaluronic Acid'],
                        purpose: 'Advanced anti-aging and barrier repair',
                        application: 'Apply 1-2 droppers to face and neck',
                        priority: 'medium'
                    },
                    {
                        step: 4,
                        product: 'Skinfix Barrier+ Triple Lipid-Peptide Cream',
                        type: 'Night Cream',
                        ingredients: ['Peptides', 'Ceramides', 'Fatty Acids'],
                        purpose: 'Intensive overnight barrier repair',
                        application: 'Apply thick layer as final step',
                        priority: 'high'
                    }
                ],
                weeklyTreatments: [
                    {
                        product: 'Laneige Water Sleeping Mask',
                        frequency: '2-3 times weekly',
                        purpose: 'Overnight intensive hydration boost',
                        application: 'Apply as final step instead of night cream'
                    },
                    {
                        product: 'The Ordinary 100% Plant-Derived Squalane',
                        frequency: 'As needed',
                        purpose: 'Extra hydration for very dry areas',
                        application: 'Mix 2-3 drops with moisturizer'
                    }
                ],
                keyIngredients: ['Hyaluronic Acid', 'Ceramides', 'Squalane', 'Peptides'],
                avoidIngredients: ['Alcohol', 'Fragrance', 'Strong exfoliants', 'Foaming cleansers'],
                expectedResults: 'Improved hydration within 1 week, barrier repair in 2-4 weeks, reduced flakiness in 3-6 weeks'
            },

            'Oily Skin': {
                description: 'AI detected excess sebum production, enlarged pores, and shine. Focus on oil control while maintaining hydration balance.',
                primaryConcerns: ['Excess oil', 'Enlarged pores', 'Shine', 'Breakouts'],
                severityLevel: 'Medium',
                morningRoutine: [
                    {
                        step: 1,
                        product: 'CeraVe Foaming Facial Cleanser',
                        type: 'Cleanser',
                        ingredients: ['Niacinamide', 'Ceramides', 'Hyaluronic Acid'],
                        purpose: 'Remove excess oil without over-drying',
                        application: 'Focus on T-zone, rinse thoroughly',
                        priority: 'high'
                    },
                    {
                        step: 2,
                        product: 'The Ordinary Niacinamide 10% + Zinc 1%',
                        type: 'Treatment Serum',
                        ingredients: ['Niacinamide 10%', 'Zinc PCA 1%'],
                        purpose: 'Control sebum production and minimize pores',
                        application: 'Apply to entire face, focus on oily areas',
                        priority: 'high'
                    },
                    {
                        step: 3,
                        product: 'La Roche-Posay Effaclar Mat Oil-Free Moisturizer',
                        type: 'Moisturizer',
                        ingredients: ['Sebulyse Technology', 'Airlicium'],
                        purpose: 'Mattifying hydration with pore refinement',
                        application: 'Apply thin layer to entire face',
                        priority: 'medium'
                    },
                    {
                        step: 4,
                        product: 'Supergoop! Unseen Sunscreen SPF 40',
                        type: 'Sunscreen',
                        ingredients: ['SPF 40', 'Red Algae', 'Frankincense'],
                        purpose: 'Weightless, invisible protection',
                        application: 'Apply as final step, perfect under makeup',
                        priority: 'high'
                    }
                ],
                eveningRoutine: [
                    {
                        step: 1,
                        product: 'The Inkey List Oat Cleansing Balm',
                        type: 'First Cleanser',
                        ingredients: ['Oat Kernel Oil', 'Squalane'],
                        purpose: 'Gentle makeup and sunscreen removal',
                        application: 'Massage dry, emulsify with water',
                        priority: 'high'
                    },
                    {
                        step: 2,
                        product: 'Paula\'s Choice Pore Normalizing Cleanser',
                        type: 'Second Cleanser',
                        ingredients: ['Ceramides', 'Chamomile', 'Green Tea'],
                        purpose: 'Deep clean pores and balance oil',
                        application: 'Follow balm cleanse, focus on pores',
                        priority: 'high'
                    },
                    {
                        step: 3,
                        product: 'The Ordinary Salicylic Acid 2% Masque',
                        type: 'Treatment (2x weekly)',
                        ingredients: ['Salicylic Acid 2%', 'Charcoal', 'Clay'],
                        purpose: 'Deep pore cleansing and oil control',
                        application: 'Apply 1-2x weekly for 10 minutes',
                        priority: 'medium'
                    },
                    {
                        step: 4,
                        product: 'Kiehl\'s Midnight Recovery Concentrate',
                        type: 'Treatment Oil',
                        ingredients: ['Squalane', 'Evening Primrose Oil', 'Lavender'],
                        purpose: 'Balance oil production overnight',
                        application: '3-4 drops pressed into skin',
                        priority: 'low'
                    }
                ],
                weeklyTreatments: [
                    {
                        product: 'The Ordinary AHA 30% + BHA 2% Peeling Solution',
                        frequency: 'Once weekly',
                        purpose: 'Deep pore purification and exfoliation',
                        warning: 'Maximum 10 minutes, avoid if skin is irritated'
                    },
                    {
                        product: 'Origins Original Skin Mask',
                        frequency: '1-2 times weekly',
                        purpose: 'Oil-absorbing and pore-refining',
                        application: 'Apply for 10 minutes, then rinse'
                    }
                ],
                keyIngredients: ['Niacinamide', 'Salicylic Acid', 'Zinc', 'Clay'],
                avoidIngredients: ['Heavy oils', 'Comedogenic ingredients', 'Alcohol-based products'],
                expectedResults: 'Reduced shine within 1 week, smaller appearing pores in 2-4 weeks, balanced oil production in 4-6 weeks'
            },

            'Normal Skin': {
                description: 'AI detected well-balanced skin with minimal concerns. Focus on maintenance, prevention, and enhancement.',
                primaryConcerns: ['Maintenance', 'Prevention', 'Enhancement'],
                severityLevel: 'Low',
                morningRoutine: [
                    {
                        step: 1,
                        product: 'Kiehl\'s Ultra Facial Cleanser',
                        type: 'Cleanser',
                        ingredients: ['Squalane', 'Avocado Oil', 'Vitamin E'],
                        purpose: 'Gentle cleansing while maintaining balance',
                        application: 'Massage for 30 seconds, rinse well',
                        priority: 'medium'
                    },
                    {
                        step: 2,
                        product: 'The Ordinary "Buffet"',
                        type: 'Multi-Technology Serum',
                        ingredients: ['Multiple Peptides', 'Amino Acids', 'Hyaluronic Acid'],
                        purpose: 'Comprehensive anti-aging and hydration',
                        application: 'Apply 1 dropper to face and neck',
                        priority: 'medium'
                    },
                    {
                        step: 3,
                        product: 'Kiehl\'s Ultra Facial Cream',
                        type: 'Moisturizer',
                        ingredients: ['Squalane', 'Glacial Glycoprotein'],
                        purpose: 'Lightweight 24-hour hydration',
                        application: 'Apply even layer to face and neck',
                        priority: 'medium'
                    },
                    {
                        step: 4,
                        product: 'La Roche-Posay Anthelios Mineral Sunscreen SPF 50',
                        type: 'Sunscreen',
                        ingredients: ['SPF 50', '100% Mineral Filters', 'Cell-Ox Shield'],
                        purpose: 'Daily broad-spectrum protection',
                        application: 'Apply as final step, reapply as needed',
                        priority: 'high'
                    }
                ],
                eveningRoutine: [
                    {
                        step: 1,
                        product: 'The Ordinary Squalane Cleanser',
                        type: 'First Cleanser',
                        ingredients: ['Squalane', 'Lipid Compounds'],
                        purpose: 'Thorough makeup and sunscreen removal',
                        application: 'Massage dry, then emulsify with water',
                        priority: 'medium'
                    },
                    {
                        step: 2,
                        product: 'CeraVe Hydrating Facial Cleanser',
                        type: 'Second Cleanser',
                        ingredients: ['Ceramides', 'Hyaluronic Acid'],
                        purpose: 'Gentle second cleanse',
                        application: 'Follow oil cleanse, rinse thoroughly',
                        priority: 'medium'
                    },
                    {
                        step: 3,
                        product: 'The Ordinary Granactive Retinoid 2% Emulsion',
                        type: 'Treatment (3-4x weekly)',
                        ingredients: ['Hydroxypinacolone Retinoate', 'Coconut Alkanes'],
                        purpose: 'Advanced anti-aging and skin renewal',
                        application: 'Apply 3-4x weekly, build up tolerance',
                        priority: 'medium'
                    },
                    {
                        step: 4,
                        product: 'Skinfix Barrier+ Triple Lipid-Peptide Cream',
                        type: 'Night Cream',
                        ingredients: ['Peptides', 'Ceramides', 'Fatty Acids'],
                        purpose: 'Overnight repair and nourishment',
                        application: 'Apply as final step',
                        priority: 'medium'
                    }
                ],
                weeklyTreatments: [
                    {
                        product: 'The Ordinary AHA 30% + BHA 2% Peeling Solution',
                        frequency: 'Once weekly',
                        purpose: 'Maintenance exfoliation and radiance',
                        application: 'Apply for 10 minutes maximum'
                    },
                    {
                        product: 'Summer Fridays Jet Lag Mask',
                        frequency: '1-2 times weekly',
                        purpose: 'Intensive hydration and glow boost',
                        application: 'Apply thick layer for 20 minutes or overnight'
                    }
                ],
                keyIngredients: ['Peptides', 'Retinoids', 'Antioxidants', 'Ceramides'],
                avoidIngredients: ['Over-exfoliation', 'Harsh ingredients', 'Unnecessary products'],
                expectedResults: 'Maintained skin health, prevention of aging signs, enhanced radiance and texture over time'
            }
        };

        // Start camera
        async function startCamera() {
            const startBtn = document.getElementById('startBtn');
            const stopBtn = document.getElementById('stopBtn');
            const analyzeBtn = document.getElementById('analyzeBtn');
            const loadingElement = document.getElementById('loading');
            const videoElement = document.getElementById('webcam-video');
            const placeholder = document.getElementById('camera-placeholder');

            try {
                loadingElement.innerHTML = 'üî¨ Starting camera...';
                startBtn.disabled = true;

                // Load AI model first
                if (!model) {
                    loadingElement.innerHTML = 'üß† Loading AI model...';
                    model = await tmImage.load(modelURL, metadataURL);
                    loadingElement.innerHTML = '‚úÖ AI model loaded!';
                }

                // Setup webcam
                loadingElement.innerHTML = 'üì∑ Accessing camera...';
                
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        width: 400, 
                        height: 300,
                        facingMode: 'user' 
                    } 
                });

                // Show video element
                videoElement.srcObject = stream;
                videoElement.classList.remove('hidden');
                placeholder.classList.add('hidden');

                // Initialize webcam for Teachable Machine
                webcam = new tmImage.Webcam(400, 300, true);
                await webcam.setup();
                await webcam.play();

                // Update UI
                loadingElement.innerHTML = '‚úÖ Camera ready! Click "Analyze Skin"';
                startBtn.classList.add('hidden');
                stopBtn.classList.remove('hidden');
                analyzeBtn.disabled = false;
                isCameraOn = true;

            } catch (error) {
                console.error('Camera error:', error);
                loadingElement.innerHTML = '‚ùå ' + error.message;
                startBtn.disabled = false;
                
                if (error.name === 'NotAllowedError') {
                    loadingElement.innerHTML = '‚ùå Camera permission denied. Please allow camera access and refresh.';
                }
            }
        }

        // Stop camera
        function stopCamera() {
            const startBtn = document.getElementById('startBtn');
            const stopBtn = document.getElementById('stopBtn');
            const analyzeBtn = document.getElementById('analyzeBtn');
            const videoElement = document.getElementById('webcam-video');
            const placeholder = document.getElementById('camera-placeholder');
            const loadingElement = document.getElementById('loading');

            // Stop analysis if running
            if (isAnalyzing) {
                stopAnalysis();
            }

            // Stop camera stream
            if (videoElement.srcObject) {
                const tracks = videoElement.srcObject.getTracks();
                tracks.forEach(track => track.stop());
                videoElement.srcObject = null;
            }

            // Stop Teachable Machine webcam
            if (webcam) {
                webcam.stop();
                webcam = null;
            }

            // Update UI
            videoElement.classList.add('hidden');
            placeholder.classList.remove('hidden');
            startBtn.classList.remove('hidden');
            stopBtn.classList.add('hidden');
            analyzeBtn.disabled = true;
            loadingElement.innerHTML = '';
            
            isCameraOn = false;
        }

        // Analyze skin
        async function analyzeSkin() {
            if (!isCameraOn || !model || !webcam) {
                alert('Please start the camera first!');
                return;
            }

            const analyzeBtn = document.getElementById('analyzeBtn');
            const loadingElement = document.getElementById('loading');

            analyzeBtn.disabled = true;
            isAnalyzing = true;
            loadingElement.innerHTML = 'üî¨ AI is analyzing your skin...';

            // Start continuous analysis
            analysisInterval = setInterval(async () => {
                if (!isAnalyzing) return;

                try {
                    const predictions = await model.predict(webcam.canvas);
                    updatePredictions(predictions);
                } catch (error) {
                    console.error('Analysis error:', error);
                }
            }, 2000);

            // Add stop analysis button
            analyzeBtn.innerHTML = '‚èπÔ∏è Stop Analysis';
            analyzeBtn.onclick = stopAnalysis;
            analyzeBtn.disabled = false;
        }

        // Stop analysis
        function stopAnalysis() {
            isAnalyzing = false;
            
            if (analysisInterval) {
                clearInterval(analysisInterval);
                analysisInterval = null;
            }

            const analyzeBtn = document.getElementById('analyzeBtn');
            const loadingElement = document.getElementById('loading');

            analyzeBtn.innerHTML = 'üîç Analyze Skin';
            analyzeBtn.onclick = analyzeSkin;
            loadingElement.innerHTML = '‚úÖ Analysis stopped';
        }

        // Update predictions display
        function updatePredictions(predictions) {
            const predictionDisplay = document.getElementById('prediction-display');
            let highestProb = 0;
            let mainLabel = '';

            let predictionsHTML = '<h4>üéØ Live AI Analysis:</h4>';
            
            predictions.forEach(prediction => {
                const percent = (prediction.probability * 100).toFixed(1);
                predictionsHTML += `
                    <div class="confidence-display">
                        <strong>${prediction.className}:</strong> ${percent}%
                    </div>
                `;

                if (prediction.probability > highestProb) {
                    highestProb = prediction.probability;
                    mainLabel = prediction.className;
                }
            });

            predictionDisplay.innerHTML = predictionsHTML;

            // Show detailed results if confidence is high
            if (highestProb > 0.7) {
                displayRealResults(mainLabel, highestProb);
            }
        }

        // Display AI analysis results
        function displayRealResults(skinType, confidence) {
            const conditionData = skinConditions[skinType] || skinConditions['Normal Skin'];
            const confidencePercent = (confidence * 100).toFixed(1);
            
            const resultElement = document.getElementById('result');
            resultElement.innerHTML = `
                <div class="result-box">
                    <h2>üéØ Professional Skin Analysis Complete!</h2>
                    <div class="skin-type">${skinType}</div>
                    <p><strong>AI Confidence:</strong> ${confidencePercent}%</p>
                    <p><strong>Description:</strong> ${conditionData.description}</p>
                    <p><strong>Primary Concerns:</strong> ${conditionData.primaryConcerns.join(', ')}</p>
                    <p><strong>Severity Level:</strong> ${conditionData.severityLevel}</p>
                    
                    <div style="margin-top: 25px;">
                        <h3>üåÖ Morning Routine (In Order)</h3>
                        ${conditionData.morningRoutine.map(step => `
                            <div class="routine-step">
                                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                    <span class="step-number">${step.step}</span>
                                    <strong>${step.product}</strong>
                                    <span class="urgency-badge priority-${step.priority}">${step.priority.toUpperCase()}</span>
                                </div>
                                <p><strong>Type:</strong> ${step.type}</p>
                                <p><strong>Key Ingredients:</strong> ${step.ingredients.map(ing => `<span class="ingredient-highlight">${ing}</span>`).join(', ')}</p>
                                <p><strong>Purpose:</strong> ${step.purpose}</p>
                                <p><strong>Application:</strong> ${step.application}</p>
                            </div>
                        `).join('')}
                    </div>

                    <div style="margin-top: 25px;">
                        <h3>üåô Evening Routine (In Order)</h3>
                        ${conditionData.eveningRoutine.map(step => `
                            <div class="routine-step">
                                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                    <span class="step-number">${step.step}</span>
                                    <strong>${step.product}</strong>
                                    <span class="urgency-badge priority-${step.priority}">${step.priority.toUpperCase()}</span>
                                </div>
                                <p><strong>Type:</strong> ${step.type}</p>
                                <p><strong>Key Ingredients:</strong> ${step.ingredients.map(ing => `<span class="ingredient-highlight">${ing}</span>`).join(', ')}</p>
                                <p><strong>Purpose:</strong> ${step.purpose}</p>
                                <p><strong>Application:</strong> ${step.application}</p>
                            </div>
                        `).join('')}
                    </div>

                    <div style="margin-top: 25px;">
                        <h3>üìÜ Weekly Treatments</h3>
                        ${conditionData.weeklyTreatments.map(treatment => `
                            <div class="product">
                                <strong>${treatment.product}</strong>
                                <p><strong>Frequency:</strong> ${treatment.frequency}</p>
                                <p><strong>Purpose:</strong> ${treatment.purpose}</p>
                                <p><strong>Application:</strong> ${treatment.application}</p>
                                ${treatment.warning ? `<p style="color: #ff6b6b;"><strong>‚ö†Ô∏è Note:</strong> ${treatment.warning}</p>` : ''}
                            </div>
                        `).join('')}
                    </div>

                    <div style="margin-top: 25px; background: rgba(255,255,255,0.2); padding: 20px; border-radius: 10px;">
                        <h3>üí° Key Recommendations</h3>
                        <p><strong>Focus on these ingredients:</strong> ${conditionData.keyIngredients.map(ing => `<span class="ingredient-highlight">${ing}</span>`).join(', ')}</p>
                        <p><strong>Avoid these ingredients:</strong> ${conditionData.avoidIngredients.join(', ')}</p>
                        <p><strong>Expected Results Timeline:</strong> ${conditionData.expectedResults}</p>
                    </div>
                </div>
            `;

            showRecommendations(skinType);
        }

        // Show product recommendations
        function showRecommendations(skinType) {
            const conditionData = skinConditions[skinType] || skinConditions['Normal Skin'];
            
            let productsHTML = `
                <div class="result-box">
                    <h3>üõí Complete Product List</h3>
                    <p>All products mentioned in your personalized routine:</p>
                    
                    <div class="product-category">
                        <h4>üß¥ Daily Essentials</h4>
                        ${[...conditionData.morningRoutine, ...conditionData.eveningRoutine].map(product => `
                            <div class="product">
                                <strong>${product.product}</strong>
                                <p><em>${product.type} - ${product.purpose}</em></p>
                                <p><strong>Key Ingredients:</strong> ${product.ingredients.join(', ')}</p>
                            </div>
                        `).join('')}
                    </div>

                    <div class="product-category">
                        <h4>üìÜ Weekly Treatments</h4>
                        ${conditionData.weeklyTreatments.map(treatment => `
                            <div class="product">
                                <strong>${treatment.product}</strong>
                                <p><em>${treatment.frequency} - ${treatment.purpose}</em></p>
                            </div>
                        `).join('')}
                    </div>

                    <div style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.2); border-radius: 10px;">
                        <strong>üí° Pro Tip:</strong> Start with the high-priority products first, then gradually incorporate medium and low-priority items. Always patch test new products!
                    </div>
                </div>
            `;
            
            document.getElementById('recommendations').innerHTML = productsHTML;
        }

        // Share function
        function shareApp() {
            const shareUrl = 'https://allyguuu.github.io/skin-ai/';
            const shareText = 'Check out this amazing AI skin analysis app! It gives professional-grade skincare routines with step-by-step application instructions.';
            
            if (navigator.share) {
                navigator.share({
                    title: 'GlowGuide AI - Professional Skin Analysis',
                    text: shareText,
                    url: shareUrl
                });
            } else {
                navigator.clipboard.writeText(shareUrl).then(() => {
                    alert('üìã Link copied to clipboard! Share: ' + shareUrl);
                });
            }
        }

        // Clean up when page closes
        window.addEventListener('beforeunload', () => {
            stopCamera();
        });

        // Initial welcome message
        window.onload = function() {
            document.getElementById('result').innerHTML = `
                <div class="result-box">
                    <h3>üëã Welcome to GlowGuide AI Pro!</h3>
                    <p>This app uses <strong>real AI to provide professional-grade skincare routines</strong> with exact application orders and ingredient-specific recommendations.</p>
                    
                    <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 10px; margin: 15px 0;">
                        <h4>üéØ What You'll Get:</h4>
                        <ul style="text-align: left; margin: 10px;">
                            <li><strong>Step-by-step routines</strong> (morning & evening)</li>
                            <li><strong>Exact application order</strong> and techniques</li>
                            <li><strong>Ingredient-focused</strong> product recommendations</li>
                            <li><strong>Priority levels</strong> for each product</li>
                            <li><strong>Weekly treatment</strong> schedule</li>
                            <li><strong>Expected results</strong> timeline</li>
                        </ul>
                    </div>
                    
                    <p><strong>Ready for your professional skincare prescription? Click "Start Camera"! üöÄ</strong></p>
                </div>
            `;
        };
    </script>
</body>
</html>
