<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SkinAI â€“ Live Skin Analysis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body{font-family:'Inter',sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;overflow-x:hidden;margin:0;padding:0;}
        .glass{background:rgba(255,255,255,.15);backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,.2);border-radius:20px;}
        .glass-dark{background:rgba(0,0,0,.2);backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,.1);border-radius:20px;}
        .btn-primary{background:linear-gradient(135deg,#667eea,#764ba2);transition:all .3s ease;}
        .btn-primary:hover{transform:translateY(-2px);box-shadow:0 10px 25px rgba(102,126,234,.4);}
        .scan-line{position:absolute;left:0;right:0;height:3px;background:linear-gradient(90deg,transparent,#667eea,transparent);box-shadow:0 0 20px #667eea;animation:scanMove 3s linear infinite;border-radius:2px;}
        @keyframes scanMove{0%{top:0;opacity:0;}5%{opacity:1;}95%{opacity:1;}100%{top:100%;opacity:0;}}
        .face-outline{position:absolute;top:50%;left:50%;width:260px;height:360px;border:3px solid rgba(255,255,255,.8);border-radius:130px 130px 180px 180px/160px 160px 200px 200px;transform:translate(-50%,-50%);pointer-events:none;}
        .loading-spinner{width:48px;height:48px;border:4px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:spin 1s linear infinite;}
        @keyframes spin{to{transform:rotate(360deg);}}
        .notification{position:fixed;top:20px;right:20px;z-index:1000;transform:translateX(400px);transition:transform .3s ease;}
        .notification.show{transform:translateX(0);}
        .tab-button{position:relative;overflow:hidden;}
        .tab-button.active::after{content:'';position:absolute;bottom:-2px;left:0;right:0;height:3px;background:#667eea;border-radius:2px;}
        #webcam-video{width:100%;border-radius:20px;display:none;}
        #camera-placeholder{border:2px dashed rgba(255,255,255,.3);border-radius:20px;}
        .product-card{transition:all .3s ease;border:1px solid rgba(255,255,255,.2);}
        .product-card:hover{transform:translateY(-5px);box-shadow:0 20px 40px rgba(0,0,0,.1);}
        .budget-badge{position:absolute;top:10px;right:10px;padding:4px 12px;border-radius:20px;font-size:.75rem;font-weight:600;z-index:10;}
        .budget-affordable{background:#10b981;color:#fff;}
        .budget-premium{background:#f59e0b;color:#fff;}
    </style>
</head>
<body class="text-white">
    <!-- NAV -->
    <nav class="glass p-4 mb-8 sticky top-4 z-50 mx-4">
        <div class="max-w-7xl mx-auto flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <div class="w-10 h-10 bg-gradient-to-r from-purple-500 to-blue-500 rounded-lg flex items-center justify-center"><i class="fas fa-brain text-white text-xl"></i></div>
                <h1 class="text-2xl font-bold">SkinAI</h1>
            </div>
            <div class="flex space-x-3">
                <button onclick="startNewAnalysis()" class="px-4 py-2 bg-white/20 hover:bg-white/30 rounded-lg transition">New Analysis</button>
                <button onclick="shareResults()" class="px-4 py-2 bg-white/20 hover:bg-white/30 rounded-lg transition">Share</button>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto px-4">
        <!-- HERO -->
        <div class="text-center mb-12">
            <div class="inline-block mb-6"><div class="w-20 h-20 bg-gradient-to-r from-purple-500 to-blue-500 rounded-full flex items-center justify-center"><i class="fas fa-microscope text-white text-3xl"></i></div></div>
            <h2 class="text-5xl font-bold mb-4">AI-Powered Skin Analysis</h2>
            <p class="text-xl text-white/80 max-w-2xl mx-auto">Real-time camera analysis + personalized skincare routine</p>
        </div>

        <!-- CAMERA -->
        <div class="glass rounded-3xl p-8 mb-8">
            <h3 class="text-2xl font-bold mb-6 text-center"><i class="fas fa-camera mr-3"></i>Real-Time Analysis</h3>
            <div class="grid md:grid-cols-2 gap-8 items-center">
                <div class="relative overflow-hidden rounded-2xl bg-black/20" id="camera-container">
                    <div id="camera-placeholder" class="p-8 text-center"><div class="text-6xl mb-4">ðŸ“·</div><p class="text-white/80">Click "Start Camera"</p></div>
                    <video id="webcam-video" autoplay playsinline muted class="hidden"></video>
                    <canvas id="webcam-canvas" width="224" height="224" class="hidden"></canvas>
                    <div id="scan-animation" class="hidden"><div class="face-outline"></div><div class="scan-line"></div></div>
                </div>
                <div class="space-y-4">
                    <div id="prediction-display" class="glass p-4 text-center text-white/80">Start camera to see AI analysis</div>
                    <div class="grid grid-cols-2 gap-3">
                        <button onclick="startCamera()" id="startBtn" class="btn-primary px-4 py-3 rounded-xl font-semibold"><i class="fas fa-play mr-2"></i>Start Camera</button>
                        <button onclick="stopCamera()" id="stopBtn" class="px-4 py-3 bg-red-500 hover:bg-red-600 rounded-xl font-semibold hidden"><i class="fas fa-stop mr-2"></i>Stop</button>
                        <button onclick="startAIAnalysis()" id="aiBtn" class="col-span-2 px-4 py-3 bg-green-500 hover:bg-green-600 rounded-xl font-semibold disabled:opacity-50" disabled><i class="fas fa-brain mr-2"></i>Analyze Skin</button>
                    </div>
                    <button onclick="showDemoResults()" class="w-full px-4 py-3 bg-purple-500 hover:bg-purple-600 rounded-xl font-semibold"><i class="fas fa-rocket mr-2"></i>Try Demo</button>
                </div>
            </div>
        </div>

        <!-- RESULTS -->
        <div id="results-section" class="hidden">
            <div class="glass rounded-3xl p-8 mb-8">
                <div class="text-center mb-6">
                    <div class="w-16 h-16 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-4"><i class="fas fa-check text-white text-2xl"></i></div>
                    <h3 class="text-3xl font-bold mb-2">Analysis Complete!</h3>
                    <p class="text-white/80">Your personalized skincare plan is ready</p>
                </div>
                <div id="skin-type-result" class="mb-6"></div>
                <div class="bg-white/95 rounded-2xl p-6"><h4 class="text-xl font-bold text-gray-800 mb-4">Skin Concerns Breakdown</h4><div id="concerns-chart" class="h-64"></div></div>
            </div>

            <!-- TABS -->
            <div class="glass rounded-2xl p-4 mb-8"><div class="flex flex-wrap gap-2 justify-center">
                <button onclick="switchTab('products')" class="tab-button active px-6 py-3 text-white font-semibold rounded-xl" id="tab-products"><i class="fas fa-shopping-cart mr-2"></i>Products</button>
                <button onclick="switchTab('routine')" class="tab-button px-6 py-3 text-white font-semibold rounded-xl" id="tab-routine"><i class="fas fa-clock mr-2"></i>Routine</button>
                <button onclick="switchTab('science')" class="tab-button px-6 py-3 text-white font-semibold rounded-xl" id="tab-science"><i class="fas fa-flask mr-2"></i>Science</button>
                <button onclick="switchTab('progress')" class="tab-button px-6 py-3 text-white font-semibold rounded-xl" id="tab-progress"><i class="fas fa-chart-line mr-2"></i>Progress</button>
            </div></div>

            <!-- TAB CONTENTS -->
            <div id="products-tab" class="tab-content"><div class="mb-6 flex items-center justify-between">
                <h4 class="text-2xl font-bold">Recommended Products</h4>
                <div class="flex space-x-2"><button onclick="filterProducts('all')" class="filter-btn active px-4 py-2 bg-white/20 rounded-lg">All</button><button onclick="filterProducts('affordable')" class="filter-btn px-4 py-2 bg-white/20 rounded-lg">Budget</button><button onclick="filterProducts('premium')" class="filter-btn px-4 py-2 bg-white/20 rounded-lg">Premium</button></div>
            </div><div id="product-grid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6"></div></div>

            <div id="routine-tab" class="tab-content hidden"><div class="grid md:grid-cols-2 gap-8">
                <div class="glass p-6"><h4 class="text-xl font-bold mb-4"><i class="fas fa-sun mr-2 text-yellow-400"></i>Morning</h4><div id="morning-routine"></div></div>
                <div class="glass p-6"><h4 class="text-xl font-bold mb-4"><i class="fas fa-moon mr-2 text-blue-300"></i>Evening</h4><div id="evening-routine"></div></div>
            </div></div>

            <div id="science-tab" class="tab-content hidden"><div class="glass p-6"><h4 class="text-xl font-bold mb-4"><i class="fas fa-microscope mr-2"></i>The Science</h4><div id="science-content" class="space-y-4"></div></div></div>

            <div id="progress-tab" class="tab-content hidden"><div class="glass p-6"><h4 class="text-xl font-bold mb-4"><i class="fas fa-chart-line mr-2"></i>Progress</h4><div id="progress-chart" class="h-64 bg-white/10 rounded-xl"></div></div></div>
        </div>

        <!-- DISCLAIMER -->
        <div class="glass rounded-2xl p-6 mt-8 text-center text-sm text-white/80"><i class="fas fa-info-circle mr-2"></i><strong>Disclaimer:</strong> Cosmetic recommendations only â€“ not medical advice. Consult a dermatologist for serious concerns.</div>
    </div>

    <!-- LOADING -->
    <div id="loading-overlay" class="fixed inset-0 bg-black/70 backdrop-blur-sm hidden items-center justify-center z-50"><div class="glass p-8 text-center"><div class="loading-spinner mx-auto mb-4"></div><h3 class="text-white text-lg">Analysingâ€¦</h3></div></div>

    <!-- NOTIFICATION -->
    <div id="notification-container" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <script>
        /* ---------- GLOBAL STATE ---------- */
        let isCameraOn=false, currentStream=null, currentSkinType='', skinAnalysis={}, analysisHistory=[];

        /* ---------- CAMERA ---------- */
        async function startCamera(){
            try{
                const stream=await navigator.mediaDevices.getUserMedia({video:{width:640,height:480,facingMode:'user'}});
                const v=document.getElementById('webcam-video');
                v.srcObject=stream; v.classList.remove('hidden');
                document.getElementById('camera-placeholder').classList.add('hidden');
                document.getElementById('startBtn').classList.add('hidden');
                document.getElementById('stopBtn').classList.remove('hidden');
                document.getElementById('aiBtn').disabled=false;
                currentStream=stream; isCameraOn=true;
                notify('Camera started','success');
            }catch{notify('Camera blocked','error');}
        }
        function stopCamera(){
            if(currentStream){currentStream.getTracks().forEach(t=>t.stop()); currentStream=null;}
            isCameraOn=false;
            document.getElementById('webcam-video').classList.add('hidden');
            document.getElementById('camera-placeholder').classList.remove('hidden');
            document.getElementById('startBtn').classList.remove('hidden');
            document.getElementById('stopBtn').classList.add('hidden');
            document.getElementById('aiBtn').disabled=true;
            stopScan(); notify('Camera stopped','info');
        }

        /* ---------- AI ANALYSIS ---------- */
        async function startAIAnalysis(){
            if(!isCameraOn){notify('Start camera first','warning'); return;}
            showLoading(true); startScan();
            await new Promise(r=>setTimeout(r,2500)); // simulate API
            const types=['Acne-Prone Skin','Dry Skin','Oily Skin','Sensitive Skin','Normal Skin'];
            currentSkinType=types[Math.floor(Math.random()*types.length)];
            skinAnalysis={skinType:currentSkinType,confidence:(85+Math.random()*10).toFixed(1),concerns:getConcerns(currentSkinType),recommendations:getRecs(currentSkinType)};
            document.getElementById('prediction-display').innerHTML=`<div class="text-white text-center"><div class="text-2xl font-bold mb-1">${currentSkinType}</div><div class="text-sm opacity-80">Confidence ${skinAnalysis.confidence}%</div></div>`;
            stopScan(); showLoading(false); showResults(); notify('Analysis complete','success');
        }
        function showDemoResults(){/* same logic without camera */ startAIAnalysis();}

        /* ---------- HELPERS ---------- */
        function getConcerns(type){
            const map={'Acne-Prone Skin':['Breakouts','Oil','Inflammation'],'Dry Skin':['Flakiness','Tightness','Barrier'],'Oily Skin':['Shine','Pores'],'Sensitive Skin':['Redness','Irritation'],'Normal Skin':['Maintenance']};
            return map[type]||map['Normal Skin'];
        }
        function getRecs(type){
            const map={'Acne-Prone Skin':'Salicylic cleanser + niacinamide','Dry Skin':'Ceramide cream + HA serum','Oily Skin':'Foam cleanser + BHA','Sensitive Skin':'Fragrance-free + centella','Normal Skin':' Gentle routine'};
            return map[type]||map['Normal Skin'];
        }
        function startScan(){document.getElementById('scan-animation').classList.remove('hidden');}
        function stopScan(){document.getElementById('scan-animation').classList.add('hidden');}
        function showLoading(show){
            document.getElementById('loading-overlay').classList.toggle('hidden',!show);
        }

        /* ---------- RESULTS ---------- */
        function showResults(){
            document.getElementById('results-section').classList.remove('hidden');
            document.getElementById('skin-type-result').innerHTML=`
                <div class="glass p-6 text-center mb-6">
                    <h3 class="text-2xl font-bold mb-2">${currentSkinType}</h3>
                    <p class="text-white/80 mb-4">${skinAnalysis.recommendations}</p>
                    <div class="flex flex-wrap gap-2 justify-center">${skinAnalysis.concerns.map(c=>`<span class="bg-white/20 px-3 py-1 rounded-full text-sm">${c}</span>`).join('')}</div>
                </div>`;
            // chart
            Plotly.newPlot('concerns-chart',[{x:skinAnalysis.concerns,y:skinAnalysis.concerns.map(()=>70+Math.random()*25),type:'bar',marker:{color:'rgba(102,126,234,.8)'}}],{margin:{t:20,b:60,l:40,r:20},paper_bgcolor:'transparent',plot_bgcolor:'transparent',font:{color:'#333'}},{responsive:true});
            loadProducts(); loadRoutine(); loadScience(); window.scrollTo({top:document.getElementById('results-section').offsetTop-20,behavior:'smooth'});
        }

        /* ---------- PRODUCTS ---------- */
        const productDB={
            'Acne-Prone Skin':[
                {id:'a1',name:'CeraVe Acne Cleanser',brand:'CeraVe',price:'$14.99',budget:'affordable',image:'https://images.unsplash.com/photo-1556228578-8c89e6adf883?w=300&h=300&fit=crop',rating:4.6,reviews:12500,ingredients:['4% Benzoyl Peroxide','Niacinamide']},
                {id:'a2',name:'Paulaâ€™s Choice 2% BHA',brand:'Paulaâ€™s Choice',price:'$32',budget:'premium',image:'https://images.unsplash.com/photo-1556228578-8c89e6adf883?w=300&h=300&fit=crop',rating:4.7,reviews:15600,ingredients:['Salicylic Acid','Green Tea']}
            ],
            'Dry Skin':[
                {id:'d1',name:'CeraVe Hydrating Cleanser',brand:'CeraVe',price:'$13.99',budget:'affordable',image:'https://images.unsplash.com/photo-1556228578-8c89e6adf883?w=300&h=300&fit=crop',rating:4.6,reviews:24500,ingredients:['Ceramides','Hyaluronic Acid']},
                {id:'d2',name:'SkinCeuticals B5 Gel',brand:'SkinCeuticals',price:'$86',budget:'premium',image:'https://images.unsplash.com/photo-1556228578-8c89e6adf883?w=300&h=300&fit=crop',rating:4.5,reviews:8900,ingredients:['Hyaluronic Acid','Vitamin B5']}
            ]
        };
        function loadProducts(){
            const prods=productDB[currentSkinType]||productDB['Acne-Prone Skin'];
            document.getElementById('product-grid').innerHTML=prods.map(p=>`
                <div class="product-card glass p-4 relative">
                    <div class="budget-badge ${p.budget==='affordable'?'budget-affordable':'budget-premium'}">${p.budget==='affordable'?'Budget':'Premium'}</div>
                    <img src="${p.image}" class="w-full h-40 object-cover rounded-xl mb-3">
                    <h5 class="font-bold text-white">${p.name}</h5>
                    <p class="text-white/70 text-sm mb-2">${p.brand}</p>
                    <div class="flex items-center justify-between mb-3"><span class="text-white font-bold">${p.price}</span><span class="text-yellow-400 text-sm">â˜… ${p.rating}</span></div>
                    <div class="flex flex-wrap gap-1 mb-3">${p.ingredients.map(i=>`<span class="text-xs bg-white/10 px-2 py-1 rounded">${i}</span>`).join('')}</div>
                    <button onclick="addToRoutine('${p.id}')" class="w-full btn-primary py-2 rounded-lg text-sm"><i class="fas fa-plus mr-2"></i>Add to Routine</button>
                </div>`).join('');
        }
        function filterProducts(budget){
            const prods=productDB[currentSkinType]||productDB['Acne-Prone Skin'];
            const filtered=budget==='all'?prods:prods.filter(p=>p.budget===budget);
            document.getElementById('product-grid').innerHTML=filtered.map(p=>`
                <div class="product-card glass p-4 relative">
                    <div class="budget-badge ${p.budget==='affordable'?'budget-affordable':'budget-premium'}">${p.budget==='affordable'?'Budget':'Premium'}</div>
                    <img src="${p.image}" class="w-full h-40 object-cover rounded-xl mb-3">
                    <h5 class="font-bold text-white">${p.name}</h5>
                    <p class="text-white/70 text-sm mb-2">${p.brand}</p>
                    <div class="flex items-center justify-between mb-3"><span class="text-white font-bold">${p.price}</span><span class="text-yellow-400 text-sm">â˜… ${p.rating}</span></div>
                    <div class="flex flex-wrap gap-1 mb-3">${p.ingredients.map(i=>`<span class="text-xs bg-white/10 px-2 py-1 rounded">${i}</span>`).join('')}</div>
                    <button onclick="addToRoutine('${p.id}')" class="w-full btn-primary py-2 rounded-lg text-sm"><i class="fas fa-plus mr-2"></i>Add to Routine</button>
                </div>`).join('');
            document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active')); event.target.classList.add('active');
        }
        function addToRoutine(id){notify('Product saved (demo)','success');}

        /* ---------- ROUTINE ---------- */
        const routineDB={
            'Acne-Prone Skin':{
                morning:[{step:1,product:'Salicylic cleanser',type:'Cleanser',purpose:'Remove oil & unclog',application:'30 s massage, rinse',timing:'Daily'},{step:2,product:'Niacinamide 10%',type:'Serum',purpose:'Oil control',application:'2-3 drops',timing:'Daily'},{step:3,product:'Oil-free moisturiser',type:'Moisturiser',purpose:'Hydrate without clogging',application:'Pea size',timing:'Daily'},{step:4,product:'Non-comedogenic SPF 30',type:'Sunscreen',purpose:'UV protection',application:'Generous',timing:'Daily'}],
                evening:[{step:1,product:'Double cleanse',type:'Cleanser',purpose:'Remove makeup & SPF',application:'Oil then foam',timing:'Daily'},{step:2,product:'2 % BHA',type:'Exfoliant',purpose:'Unclog pores',application:'Thin layer',timing:'3Ã—/week'},{step:3,product:'Benzoyl peroxide 2.5 %',type:'Treatment',purpose:'Kill bacteria',application:'Spot or layer',timing:'Daily'},{step:4,product:'Light moisturiser',type:'Moisturiser',purpose:'Barrier support',application:'After treatments',timing:'Daily'}]
            },
            'Dry Skin':{
                morning:[{step:1,product:'Cream cleanser',type:'Cleanser',purpose:'Cleanse w/o stripping',application:'Gentle massage',timing:'Daily'},{step:2,product:'Hyaluronic serum',type:'Serum',purpose:'Deep hydration',application:'On damp skin',timing:'Daily'},{step:3,product:'Ceramide cream',type:'Moisturiser',purpose:'Barrier repair',application:'Generous',timing:'Daily'},{step:4,product:'Hydrating SPF 30',type:'Sunscreen',purpose:'UV + moisture',application:'Final step',timing:'Daily'}],
                evening:[{step:1,product:'Cleansing balm',type:'Cleanser',purpose:'Dissolve makeup',application:'Dry skin massage',timing:'Daily'},{step:2,product:'Hydrating cleanser',type:'Cleanser',purpose:'Remove residue',application:'Gentle',timing:'Daily'},{step:3,product:'Facial oil',type:'Treatment',purpose:'Seal moisture',application:'2-3 drops',timing:'Daily'},{step:4,product:'Rich night cream',type:'Moisturiser',purpose:'Overnight repair',application:'Thick layer',timing:'Daily'}]
            }
        };
        function loadRoutine(){
            const r=routineDB[currentSkinType]||routineDB['Acne-Prone Skin'];
            document.getElementById('morning-routine').innerHTML=r.morning.map(s=>`
                <div class="glass p-4 mb-3">
                    <div class="flex items-center justify-between mb-2"><span class="bg-purple-500 text-white px-3 py-1 rounded-full text-sm font-bold">Step ${s.step}</span><span class="text-white/60 text-sm">${s.timing}</span></div>
                    <h5 class="font-bold text-white mb-1">${s.product}</h5>
                    <p class="text-white/80 text-sm mb-2">${s.purpose}</p>
                    <p class="text-white/60 text-xs"><strong>How:</strong> ${s.application}</p>
                </div>`).join('');
            document.getElementById('evening-routine').innerHTML=r.evening.map(s=>`
                <div class="glass p-4 mb-3">
                    <div class="flex items-center justify-between mb-2"><span class="bg-blue-500 text-white px-3 py-1 rounded-full text-sm font-bold">Step ${s.step}</span><span class="text-white/60 text-sm">${s.timing}</span></div>
                    <h5 class="font-bold text-white mb-1">${s.product}</h5>
                    <p class="text-white/80 text-sm mb-2">${s.purpose}</p>
                    <p class="text-white/60 text-xs"><strong>How:</strong> ${s.application}</p>
                </div>`).join('');
        }

        /* ---------- SCIENCE ---------- */
        const scienceDB={
            'Acne:'CeraVe',price:'$14.99',budget:'affordable',rating:4.6,reviews:12500,ing:['Benzoyl Peroxide','Niacinamide']},
                {id:'a2',name:'Paula\'s Choice BHA',brand:'Paula\'s Choice',price:'$32',budget:'premium',rating:4.7,reviews:15600,ing:['Salicylic Acid','Green Tea']}
            ],
            'Dry Skin':[
                {id:'d1',name:'CeraVe Hydrating Cleanser',brand:'CeraVe',price:'$13.99',budget:'affordable',rating:4.6,reviews:24500,ing:['Ceramides','Hyaluronic Acid']},
                {id:'d2',name:'SkinCeuticals B5 Gel',brand:'SkinCeuticals',price:'$86',budget:'premium',rating:4.5,reviews:8900,ing:['Hyaluronic Acid','Vitamin B5']}
            ]
        };
        function loadProducts(){
            const list=(productDB[currentSkinType]||productDB['Acne-Prone Skin']).map(p=>`
                <div class="product-card glass p-4" data-budget="${p.budget}">
                    <div class="budget-badge ${p.budget==='affordable'?'budget-affordable':'budget-premium'}">${p.budget==='affordable'?'Budget':'Premium'}</div>
                    <img src="https://images.unsplash.com/photo-1556228578-8c89e6adf883?w=300&h=300&fit=crop" class="w-full h-32 object-cover rounded mb-3">
                    <h5 class="font-bold mb-1">${p.name}</h5>
                    <p class="text-white/70 text-sm mb-2">${p.brand}</p>
                    <div class="flex items-center mb-2"><div class="flex text-yellow-400 text-xs mr-2">${'â˜…'.repeat(Math.floor(p.rating))}</div><span class="text-white/60 text-xs">${p.rating} (${p.reviews})</span></div>
                    <div class="flex flex-wrap gap-1 mb-3">${p.ing.slice(0,2).map(i=>`<span class="ingredient-tag text-xs px-2 py-1">${i}</span>`).join('')}</div>
                    <div class="flex items-center justify-between"><span class="font-bold text-white">${p.price}</span><button onclick="addToRoutine('${p.id}')" class="px-3 py-1 bg-gradient-to-r from-purple-500 to-blue-500 rounded text-sm">Add</button></div>
                </div>`).join('');
            document.getElementById('product-grid').innerHTML=list;
        }
        function filterProducts(budget){
            document.querySelectorAll('.product-card').forEach(card=>{
                card.style.display=(budget==='all'||card.dataset.budget===budget)?'block':'none';
            });
            document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
            event.target.classList.add('active');
        }

        /* ---------- ROUTINE ---------- */
        function loadRoutine(){
            const r=getRoutineForSkinType(currentSkinType);
            document.getElementById('morning-routine').innerHTML=r.morning.map(s=>stepHTML(s,'purple')).join('');
            document.getElementById('evening-routine').innerHTML=r.evening.map(s=>stepHTML(s,'blue')).join('');
        }
        function stepHTML(s,color){
            return`<div class="routine-step glass p-4 mb-3"><div class="flex items-center justify-between mb-2"><span class="bg-gradient-to-r from-${color}-500 to-${color}-600 text-white px-3 py-1 rounded-full text-xs font-bold">Step ${s.step}</span><span class="text-white/60 text-xs">${s.timing}</span></div><h6 class="font-bold mb-1">${s.product}</h6><p class="text-white/80 text-sm mb-2">${s.purpose}</p><div class="text-white/70 text-xs"><strong>How:</strong> ${s.application}</div></div>`;
        }
        function getRoutineForSkinType(type){
            const db={
                'Acne-Prone Skin':{
                    morning:[{step:1,product:'Salicylic Cleanser',purpose:'Remove oil',application:'30s massage, rinse',timing:'Daily'},{step:2,product:'Niacinamide Serum',purpose:'Control oil',application:'3 drops, pat',timing:'Daily'},{step:3,product:'Oil-free Moisturizer',purpose:'Hydrate',application:'Pea size',timing:'Daily'},{step:4,product:'SPF 30',purpose:'UV protection',application:'Before sun',timing:'Daily'}],
                    evening:[{step:1,product:'Double Cleanse',purpose:'Remove buildup',application:'Oil then foam',timing:'Daily'},{step:2,product:'BHA Exfoliant',purpose:'Unclog pores',application:'Thin layer',timing:'3Ã—/wk'},{step:3,product:'Treatment',purpose:'Target spots',application:'Spot or all-over',timing:'Daily'},{step:4,product:'Light Moisturizer',purpose:'Barrier support',application:'After treatments',timing:'Daily'}]
                },
                'Dry Skin':{
                    morning:[{step:1,product:'Cream Cleanser',purpose:'Gentle cleanse',application:'Rinse lukewarm',timing:'Daily'},{step:2,product:'HA Serum',purpose:'Hydration',application:'On damp skin',timing:'Daily'},{step:3,product:'Ceramide Cream',purpose:'Barrier repair',application:'Massage well',timing:'Daily'},{step:4,product:'Hydrating SPF',purpose:'Protect + hydrate',application:'Final step',timing:'Daily'}],
                    evening:[{step:1,product:'Cleansing Balm',purpose:'Dissolve makeup',application:'Dry skin first',timing:'Daily'},{step:2,product:'Hydrating Cleanser',purpose:'Remove residue',application:'Gentle massage',timing:'Daily'},{step:3,product:'Serum/Oil',purpose:'Overnight hydration',application:'Layer then oil',timing:'Daily'},{step:4,product:'Rich Night Cream',purpose:'Intensive repair',application:'Generous amount',timing:'Daily'}]
                }
            };
            return db[type]||db['Acne-Prone Skin'];
        }

        /* ---------- SCIENCE ---------- */
        function loadScience(){
            const sci=getScienceForSkinType(currentSkinType);
            document.getElementById('science-content').innerHTML=sci.map(s=>`<div class="glass p-4"><h5 class="font-bold mb-2">${s.title}</h5><p class="text-white/80 text-sm">${s.content}</p></div>`).join('');
        }
        function getScienceForSkinType(type){
            const db={
                'Acne-Prone Skin':[
                    {title:'Salicylic Acid Power',content:'Oil-soluble BHA dissolves dead cells inside pores, reducing clogs by 60%.'},
                    {title:'Niacinamide Benefits','content':'Regulates oil, calms inflammation, and fades marksâ€”proven 40-60% acne reduction.'}
                ],
                'Dry Skin':[
                    {title:'Hyaluronic Acid','content':'Holds 1000Ã— its weight in water, drawing moisture deep into skin.'},
                    {title:'Ceramides','content':'50% of skin barrier; supplementation cuts water loss 45%.'}
                ]
            };
            return db[type]||db['Acne-Prone Skin'];
        }

        /* ---------- TABS ---------- */
        function switchTab(name){
            document.querySelectorAll('.tab-content').forEach(t=>t.classList.add('hidden'));
            document.querySelectorAll('.tab-button').forEach(b=>b.classList.remove('active'));
            document.getElementById(name+'-tab').classList.remove('hidden');
            document.getElementById('tab-'+name).classList.add('active');
            if(name==='progress')loadProgress();
        }

        /* ---------- PROGRESS ---------- */
        function loadProgress(){
            const dates=['2 May','9 May','16 May','23 May','30 May'];
            const vals=[82,85,88,86,90];
            Plotly.newPlot('progress-chart',[{x:dates,y:vals,type:'scatter',mode:'lines+markers',line:{color:'#667eea',width:3},marker:{color:'#667eea',size:8},fill:'tozeroy',fillcolor:'rgba(102,126,234,.2)'}],{margin:{t:20,b:40,l:40,r:20},paper_bgcolor:'transparent',plot_bgcolor:'transparent',font:{color:'white'}},{responsive:true});
        }

        /* ---------- SHARE / NEW ---------- */
        function shareResults(){
            const txt=`I just discovered my skin type is ${currentSkinType} with SkinAI!`;
            navigator.clipboard.writeText(txt+' '+location.href).then(()=>notify('Copied to clipboard!','success'));
        }
        function startNewAnalysis(){currentSkinType=''; document.getElementById('results-section').classList.add('hidden'); window.scrollTo({top:0,behavior:'smooth'}); notify('Ready for new scan','info');}

        /* ---------- NOTIFICATION ---------- */
        function notify(msg,type){
            const colors={success:'bg-green-500',error:'bg-red-500',warning:'bg-yellow-500',info:'bg-blue-500'};
            const n=document.createElement('div'); n.className=`notification ${colors[type]} text-white px-4 py-2 rounded shadow-lg max-w-sm`; n.innerHTML=`<i class="fas fa-${type==='success'?'check':type==='error'?'exclamation-triangle':'info'} mr-2"></i>${msg}`;
            document.getElementById('notification-container').appendChild(n);
            setTimeout(()=>n.classList.add('show'),100);
            setTimeout(()=>{n.classList.remove('show'); setTimeout(()=>n.remove(),300)},2500);
        }

        /* ---------- INITIALISE ---------- */
        document.addEventListener('DOMContentLoaded',()=>{});
    </script>
</body>
</html>
